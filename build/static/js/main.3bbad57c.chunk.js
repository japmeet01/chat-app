(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{201:function(e,t,a){e.exports=a(377)},207:function(e,t,a){},377:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(36),l=a.n(c),o=a(56),i=(a(206),a(207),a(9)),s=a(10),u=a.n(s),m=a(12),d=a(22),f=a.n(d),p=a(387),b=a(391),h=a(392),E=a(393),v=a(394),g=a(389),k=a(93),O=a(92),j=(a(212),a(214),a(378),f.a.initializeApp({apiKey:"AIzaSyAd_fVH90WIZ9vVUdewWISyK5I2MBSn5DU",authDomain:"chat-d5bb6.firebaseapp.com",databaseURL:"https://chat-d5bb6-default-rtdb.europe-west1.firebasedatabase.app",projectId:"chat-d5bb6",storageBucket:"chat-d5bb6.appspot.com",messagingSenderId:"766882374089",appId:"1:766882374089:web:f0c90cdc0aaf067473c818"})),x=j.auth(),w=j.database(),y=j.storage(),C=function(){var e=function(){var e=Object(m.a)(u.a.mark((function e(t){var a,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x.signInWithPopup(t);case 3:if(a=e.sent,n=a.additionalUserInfo,r=a.user,!n.isNewUser){e.next=9;break}return e.next=9,w.ref("/profiles/".concat(r.uid)).set({name:r.displayName,createdAt:f.a.database.ServerValue.TIMESTAMP});case 9:p.a.success("Signed in",4e3),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),p.a.error(e.t0.message,4e3);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(b.a,null,r.a.createElement(h.a,{className:"mt-page"},r.a.createElement(E.a,null,r.a.createElement(v.a,{xs:24,md:12,mdOffset:6},r.a.createElement(g.a,null,r.a.createElement("div",{className:"text-center"},r.a.createElement("h2",null,"Welcome to Let's Chat"),r.a.createElement("p",null,"Create your own chat rooms or join other's")),r.a.createElement("div",{className:"mt-3"},r.a.createElement(k.a,{block:!0,color:"blue",onClick:function(){e(new f.a.auth.FacebookAuthProvider)}},r.a.createElement(O.a,{icon:"facebook"})," Continue with Facebook"),r.a.createElement(k.a,{block:!0,color:"green",onClick:function(){e(new f.a.auth.GoogleAuthProvider)}},r.a.createElement(O.a,{icon:"google"})," Continue with Google")))))))},N=a(27),S=a(395),T=a(11),A={state:"offline",last_changed:f.a.database.ServerValue.TIMESTAMP},I={state:"online",last_changed:f.a.database.ServerValue.TIMESTAMP},D=Object(n.createContext)(),L=function(e){var t=e.children,a=Object(n.useState)(null),c=Object(T.a)(a,2),l=c[0],o=c[1],i=Object(n.useState)(!0),s=Object(T.a)(i,2),u=s[0],m=s[1];return Object(n.useEffect)((function(){var e,t,a=x.onAuthStateChanged((function(a){a?(t=w.ref("/status/".concat(a.uid)),(e=w.ref("/profiles/".concat(a.uid))).on("value",(function(e){var t=e.val(),n={name:t.name,createdAt:t.createdAt,avatar:t.avatar,uid:a.uid,email:a.email};o(n),m(!1)})),w.ref(".info/connected").on("value",(function(e){!1!==!!e.val()&&t.onDisconnect().set(A).then((function(){t.set(I)}))}))):(e&&e.off(),t&&t.off(),w.ref(".info/connected").off(),o(null),m(!1))}));return function(){a(),w.ref(".info/connected").off(),e&&e.off(),t&&t.off()}}),[]),r.a.createElement(D.Provider,{value:{isLoading:u,profile:l}},t)},U=function(){return Object(n.useContext)(D)},H=function(e){var t=e.children,a=Object(N.a)(e,["children"]),n=U(),c=n.profile,l=n.isLoading;return l&&!c?r.a.createElement(b.a,null,r.a.createElement(S.a,{center:!0,vertical:!0,size:"md",content:"Loading",speed:"slow"})):c||l?r.a.createElement(i.b,a,t):r.a.createElement(i.a,{to:"/signin"})},M=a(398),F=a(390);function B(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(n.useState)(e),a=Object(T.a)(t,2),r=a[0],c=a[1],l=Object(n.useCallback)((function(){return c(!0)}),[]),o=Object(n.useCallback)((function(){return c(!1)}),[]);return{isOpen:r,open:l,close:o}}var P=function(e){var t=Object(n.useState)((function(){return window.matchMedia(e).matches})),a=Object(T.a)(t,2),r=a[0],c=a[1];return Object(n.useEffect)((function(){var t=window.matchMedia(e);c(t.matches);var a=function(e){return c(e.matches)};return t.addListener(a),function(){return t.removeListener(a)}}),[e]),r};var R=a(381),V=a(198),z=function(e){var t=e.initialValue,a=e.onSave,c=e.label,l=void 0===c?null:c,o=e.placeholder,i=void 0===o?"Write your value":o,s=e.emptyMsg,d=void 0===s?"Input is empty":s,f=e.wrapperClassName,b=void 0===f?"":f,h=Object(N.a)(e,["initialValue","onSave","label","placeholder","emptyMsg","wrapperClassName"]),E=Object(n.useState)(t),v=Object(T.a)(E,2),g=v[0],k=v[1],j=Object(n.useState)(!1),x=Object(T.a)(j,2),w=x[0],y=x[1],C=Object(n.useCallback)((function(e){k(e)}),[]),S=Object(n.useCallback)((function(){y((function(e){return!e})),k(t)}),[t]),A=function(){var e=Object(m.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===(n=g.trim())&&p.a.info(d,4e3),n===t){e.next=5;break}return e.next=5,a(n);case 5:y(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:b},l,r.a.createElement(R.a,null,r.a.createElement(V.a,Object.assign({},h,{disabled:!w,placeholder:i,value:g,onChange:C})),r.a.createElement(R.a.Button,{onClick:S},r.a.createElement(O.a,{icon:w?"close":"edit2"})),w&&r.a.createElement(R.a.Button,{onClick:A},r.a.createElement(O.a,{icon:"check"}))))},W=a(53),q=a(18),_=a(396),G=function(){var e=Object(n.useState)({"google.com":x.currentUser.providerData.some((function(e){return"google.com"===e.providerId})),"facebook.com":x.currentUser.providerData.some((function(e){return"facebook.com"===e.providerId}))}),t=Object(T.a)(e,2),a=t[0],c=t[1],l=function(e,t){c((function(a){return Object(q.a)(Object(q.a)({},a),{},Object(W.a)({},e,t))}))},o=function(){var e=Object(m.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,1!==x.currentUser.providerData.length){e.next=3;break}throw new Error("You can not disconnect from ".concat(t));case 3:return e.next=5,x.currentUser.unlink(t);case 5:l(t,!1),p.a.info("Disconnected from ".concat(t),4e3),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),p.a.error(e.t0.message,4e3);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),i=function(){var e=Object(m.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x.currentUser.linkWithPopup(t);case 3:p.a.info("Linked to ".concat(t.providerId),4e3),l(t.providerId,!0),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),p.a.error(e.t0.message,400);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",null,a["google.com"]&&r.a.createElement(_.a,{color:"green",closable:!0,onClose:function(){o("google.com")}},r.a.createElement(O.a,{icon:"google"})," Connected"),a["facebook.com"]&&r.a.createElement(_.a,{color:"blue",closable:!0,onClose:function(){o("facebook.com")}},r.a.createElement(O.a,{icon:"facebook"})," Connected"),r.a.createElement("div",{className:"mt-2"},!a["google.com"]&&r.a.createElement(k.a,{block:!0,color:"green",onClick:function(){i(new f.a.auth.GoogleAuthProvider)}},r.a.createElement(O.a,{icon:"google"})," Link to Google"),!a["facebook.com"]&&r.a.createElement(k.a,{block:!0,color:"blue",onClick:function(){i(new f.a.auth.FacebookAuthProvider)}},r.a.createElement(O.a,{icon:"facebook"})," Link to Facebook")))},K=a(382),J=a(186),Y=a.n(J),Z=a(397);function Q(e){return e?Object.keys(e).map((function(t){return Object(q.a)(Object(q.a)({},e[t]),{},{id:t})})):[]}function X(e,t,a,n){return $.apply(this,arguments)}function $(){return($=Object(m.a)(u.a.mark((function e(t,a,n,r){var c,l,o,i,s,m,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(c={})["/profiles/".concat(t,"/").concat(a)]=n,l=r.ref("/messages").orderByChild("author/uid").equalTo(t).once("value"),o=r.ref("/rooms").orderByChild("lastMessage/author/uid").equalTo(t).once("value"),e.next=6,Promise.all([l,o]);case 6:return i=e.sent,s=Object(T.a)(i,2),m=s[0],d=s[1],m.forEach((function(e){c["/messages/".concat(e.key,"/author/").concat(a)]=n})),d.forEach((function(e){c["/rooms/".concat(e.key,"/lastMessage/author/").concat(a)]=n})),e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ee=function(e){var t=e.name,a=Object(N.a)(e,["name"]);return r.a.createElement(Z.a,Object.assign({circle:!0},a),function(e){var t=e.toUpperCase().split(" ");return t.length>1?t[0][0]+t[1][0]:t[0][0]}(t))},te=["image/png","image/jpeg","image/pjpeg"],ae=function(e){return new Promise((function(t,a){e.toBlob((function(e){e?t(e):a(new Error("File process error"))}))}))},ne=function(){var e=B(),t=e.isOpen,a=e.open,c=e.close,l=U().profile,o=Object(n.useState)(null),i=Object(T.a)(o,2),s=i[0],d=i[1],f=Object(n.useState)(!1),b=Object(T.a)(f,2),h=b[0],E=b[1],v=Object(n.useRef)(),g=function(){var e=Object(m.a)(u.a.mark((function e(){var t,a,n,r,c,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.current.getImageScaledToCanvas(),E(!0),e.prev=2,e.next=5,ae(t);case 5:return a=e.sent,n=y.ref("/profile/".concat(l.uid)).child("avatar"),e.next=9,n.put(a,{cacheControl:"public, max-age=".concat(259200)});case 9:return r=e.sent,e.next=12,r.ref.getDownloadURL();case 12:return c=e.sent,e.next=15,X(l.uid,"avatar",c,w);case 15:return o=e.sent,e.next=18,w.ref().update(o);case 18:E(!1),p.a.info("Avatar has been uploaded",4e3),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(2),E(!1),p.a.error(e.t0.message,4e3);case 26:case"end":return e.stop()}}),e,null,[[2,22]])})));return function(){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"mt-3 text-center"},r.a.createElement(ee,{src:l.avatar,name:l.name,className:"width-200 height-200 img-fullsize font-huge"}),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"avatar-upload",className:"d-block cursor-pointer padded"},"Select new avatar",r.a.createElement("input",{id:"avatar-upload",type:"file",className:"d-none",accept:".png, .jpeg, .jpg",onChange:function(e){var t=e.target.files;if(1===t.length){var n=t[0];!function(e){return te.includes(e.type)}(n)?p.a.warning("Wrong file type ".concat(n.type),4e3):(d(n),a())}}})),r.a.createElement(K.a,{show:t,onHide:c},r.a.createElement(K.a.Header,null,r.a.createElement(K.a.Title,null,"Adjust and upload new avatar")),r.a.createElement(K.a.Body,null,r.a.createElement("div",{className:"d-flex justify-content-center align-items-center h-100"},s&&r.a.createElement(Y.a,{ref:v,image:s,width:200,height:200,border:10,borderRadius:100,rotate:0}))),r.a.createElement(K.a.Footer,null,r.a.createElement(k.a,{block:!0,appearance:"ghost",onClick:g,disabled:h},"Upload new avatar")))))},re=function(e){var t=e.onSignOut,a=U().profile,n=function(){var e=Object(m.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,X(a.uid,"name",t,w);case 3:return n=e.sent,e.next=6,w.ref().update(n);case 6:p.a.success("Nickname has been updated",4e3),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),p.a.error(e.t0.message,4e3);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a.Header,null,r.a.createElement(F.a.Title,null,"Dashboard")),r.a.createElement(F.a.Body,null,r.a.createElement("h3",null,"Hey, ",a.name),r.a.createElement(G,null),r.a.createElement(M.a,null),r.a.createElement(z,{name:"nickname",initialValue:a.name,onSave:n,label:r.a.createElement("h6",{className:"mb-2"},"Nickname")}),r.a.createElement(ne,null)),r.a.createElement(F.a.Footer,null,r.a.createElement(k.a,{block:!0,color:"red",onClick:t},"Sign out")))},ce=function(){var e=B(),t=e.isOpen,a=e.close,c=e.open,l=P("(max-width: 992px)"),o=Object(n.useCallback)((function(){w.ref("/status/".concat(x.currentUser.uid)).set(A).then((function(){x.signOut(),p.a.info("Signed out",4e3),a()})).catch((function(e){p.a.error(e.message,4e3)}))}),[a]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(k.a,{block:!0,color:"blue",onClick:c},r.a.createElement(O.a,{icon:"dashboard"})," Dashboard"),r.a.createElement(F.a,{full:l,show:t,onHide:a,placement:"left"},r.a.createElement(re,{onSignOut:o})))},le=a(399),oe=a(400),ie=a(383),se=a(401),ue=a(388),me=le.a.Types.StringType,de=le.a.Model({name:me().isRequired("Chat name is required"),description:me().isRequired("Description is required")}),fe={name:"",description:""},pe=function(){var e=B(),t=e.isOpen,a=e.open,c=e.close,l=Object(n.useState)(fe),o=Object(T.a)(l,2),i=o[0],s=o[1],d=Object(n.useState)(!1),b=Object(T.a)(d,2),h=b[0],E=b[1],v=Object(n.useRef)(),g=Object(n.useCallback)((function(e){s(e)}),[]),j=function(){var e=Object(m.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.current.check()){e.next=2;break}return e.abrupt("return");case 2:return E(!0),t=Object(q.a)(Object(q.a)({},i),{},{createdAt:f.a.database.ServerValue.TIMESTAMP,admins:Object(W.a)({},x.currentUser.uid,!0)}),e.prev=4,e.next=7,w.ref("rooms").push(t);case 7:p.a.info("".concat(i.name," has been created"),4e3),E(!1),s(fe),c(),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),E(!1),p.a.error(e.t0.message,4e3);case 17:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"mt-1"},r.a.createElement(k.a,{block:!0,color:"green",onClick:a},r.a.createElement(O.a,{icon:"creative"})," Create new chat room"),r.a.createElement(K.a,{show:t,onHide:c},r.a.createElement(K.a.Header,null,r.a.createElement(K.a.Title,null,"New chat room")),r.a.createElement(K.a.Body,null,r.a.createElement(oe.a,{fluid:!0,onChange:g,formValue:i,model:de,ref:v},r.a.createElement(ie.a,null,r.a.createElement(se.a,null,"Room name"),r.a.createElement(ue.a,{name:"name",placeholder:"Enter chat room name..."})),r.a.createElement(ie.a,null,r.a.createElement(se.a,null,"Description"),r.a.createElement(ue.a,{componentClass:"textarea",rows:5,name:"description",placeholder:"Enter room description..."})))),r.a.createElement(K.a.Footer,null,r.a.createElement(k.a,{block:!0,appearance:"primary",onClick:j,disabled:h},"Create new chat room"))))},be=a(385),he=a(87),Ee=function(e){var t=e.room,a=t.createdAt,n=t.name,c=t.lastMessage;return r.a.createElement("div",null,r.a.createElement("div",{className:"d-flex justify-content-between align-items-center"},r.a.createElement("h3",{className:"text-disappear"},n),r.a.createElement(he.a,{datetime:c?new Date(c.createdAt):new Date(a),className:"font-normal text-black-45"})),r.a.createElement("div",{className:"d-flex align-items-center text-black-70"},c?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"d-flex align-items-center"},r.a.createElement(ee,{src:c.author.avatar,name:c.author.name,size:"sm"})),r.a.createElement("div",{className:"text-disappear ml-2"},r.a.createElement("div",{className:"italic"},c.author.name),r.a.createElement("span",null,c.text||c.file.name))):r.a.createElement("span",null,"No messages yet...")))},ve=Object(n.createContext)(),ge=function(e){var t=e.children,a=Object(n.useState)(null),c=Object(T.a)(a,2),l=c[0],o=c[1];return Object(n.useEffect)((function(){var e=w.ref("rooms");return e.on("value",(function(e){var t=Q(e.val());o(t)})),function(){e.off()}}),[]),r.a.createElement(ve.Provider,{value:l},t)},ke=function(){return Object(n.useContext)(ve)},Oe=function(e){var t=e.aboveElHeight,a=ke(),n=Object(i.g)();return r.a.createElement(be.a,{appearance:"subtle",vertical:!0,reversed:!0,className:"overflow-y-scroll custom-scroll",style:{height:"calc(100% - ".concat(t,"px)")},activeKey:n.pathname},!a&&r.a.createElement(S.a,{center:!0,vertical:!0,content:"Loading",speed:"slow",size:"md"}),a&&a.length>0&&a.map((function(e){return r.a.createElement(be.a.Item,{componentClass:o.b,to:"/chat/".concat(e.id),key:e.id,eventKey:"/chat/".concat(e.id)},r.a.createElement(Ee,{room:e}))})))},je=function(){var e=Object(n.useRef)(),t=Object(n.useState)(0),a=Object(T.a)(t,2),c=a[0],l=a[1];return Object(n.useEffect)((function(){e.current&&l(e.current.scrollHeight)}),[e]),r.a.createElement("div",{className:"h-100 pt-2"},r.a.createElement("div",{ref:e},r.a.createElement(ce,null),r.a.createElement(pe,null),r.a.createElement(M.a,null,"Join conversation")),r.a.createElement(Oe,{aboveElHeight:c}))},xe=a(402),we=a(131),ye=Object(we.createContext)(),Ce=function(e){var t=e.children,a=e.data;return r.a.createElement(ye.Provider,{value:a},t)},Ne=function(e){return Object(we.useContextSelector)(ye,e)},Se=Object(n.memo)((function(){var e=B(),t=e.isOpen,a=e.close,n=e.open,c=Ne((function(e){return e.description})),l=Ne((function(e){return e.name}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(k.a,{appearance:"link",className:"px-0",onClick:n},"Room information"),r.a.createElement(K.a,{show:t,onHide:a},r.a.createElement(K.a.Header,null,r.a.createElement(K.a.Title,null,"About ",l)),r.a.createElement(K.a.Body,null,r.a.createElement("h6",{className:"mb-1"},"Description"),r.a.createElement("p",null,c)),r.a.createElement(K.a.Footer,null,r.a.createElement(k.a,{block:!0,onClick:a},"Close"))))})),Te=Object(n.memo)((function(){var e=B(),t=e.isOpen,a=e.open,n=e.close,c=Object(i.h)().chatId,l=P("(max-width: 992px)"),o=Ne((function(e){return e.name})),s=Ne((function(e){return e.description})),u=function(e,t){w.ref("rooms/".concat(c)).child(e).set(t).then((function(){p.a.success("Successfully updated",4e3)})).catch((function(e){p.a.error(e.message,4e3)}))};return r.a.createElement("div",null,r.a.createElement(k.a,{className:"br-circle",size:"sm",color:"red",onClick:a},"A"),r.a.createElement(F.a,{full:l,show:t,onHide:n,placement:"right"},r.a.createElement(F.a.Header,null,r.a.createElement(F.a.Title,null,"Edit Room")),r.a.createElement(F.a.Body,null,r.a.createElement(z,{initialValue:o,onSave:function(e){u("name",e)},label:r.a.createElement("h6",{className:"mb-2"},"Name"),emptyMsg:"Name can not be empty"}),r.a.createElement(z,{componentClass:"textarea",rows:5,initialValue:s,onSave:function(e){u("description",e)},emptyMsg:"Description can not be empty",wrapperClassName:"mt-3"})),r.a.createElement(F.a.Footer,null,r.a.createElement(k.a,{block:!0,onClick:n},"Close"))))})),Ae=Object(n.memo)((function(){var e=Ne((function(e){return e.name})),t=Ne((function(e){return e.isAdmin})),a=P("(max-width: 992px)");return r.a.createElement("div",null,r.a.createElement("div",{className:"d-flex justify-content-between align-items-center"},r.a.createElement("h4",{className:"text-disappear d-flex align-items-center"},r.a.createElement(O.a,{componentClass:o.b,to:"/",icon:"arrow-circle-left",size:"2x",className:a?"d-inline-block p-0 mr-2 text-blue link-unstyled":"d-none"}),r.a.createElement("span",{className:"text-disappear"},e)),r.a.createElement(xe.a,{className:"ws-nowrap"},t&&r.a.createElement(Te,null))),r.a.createElement("div",{className:"d-flex justify-content-between align-items-center"},r.a.createElement("span",null,"todo"),r.a.createElement(Se,null)))})),Ie=a(386),De=function(e){var t=e.afterUpload,a=Object(i.h)().chatId,c=B(),l=c.isOpen,o=c.close,s=c.open,d=Object(n.useState)([]),f=Object(T.a)(d,2),b=f[0],h=f[1],E=Object(n.useState)(!1),v=Object(T.a)(E,2),g=v[0],j=v[1],x=function(){var e=Object(m.a)(u.a.mark((function e(){var n,r,c,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=b.map((function(e){return y.ref("/chat/".concat(a)).child(Date.now()+e.name).put(e.blobFile,{cacheControl:"public, max-age=".concat(259200)})})),e.next=4,Promise.all(n);case 4:return r=e.sent,c=r.map(function(){var e=Object(m.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.metadata.contentType,e.t1=t.metadata.name,e.next=4,t.ref.getDownloadURL();case 4:return e.t2=e.sent,e.abrupt("return",{contentType:e.t0,name:e.t1,url:e.t2});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=8,Promise.all(c);case 8:return l=e.sent,e.next=11,t(l);case 11:j(!1),o(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),j(!1),p.a.error(e.t0.message);case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(R.a.Button,{onClick:s},r.a.createElement(O.a,{icon:"attachment"})),r.a.createElement(K.a,{show:l,onHide:o},r.a.createElement(K.a.Header,null,r.a.createElement(K.a.Title,null,"Upload files")),r.a.createElement(K.a.Body,null,r.a.createElement(Ie.a,{autoUpload:!1,action:"",fileList:b,onChange:function(e){var t=e.filter((function(e){return e.blobFile.size<=512e4})).slice(0,5);h(t)},multiple:!0,listType:"picture-text",className:"w-100",disabled:g})),r.a.createElement(K.a.Footer,null,r.a.createElement(k.a,{block:!0,disabled:g,onClick:x},"Send to chat"),r.a.createElement("div",{className:"text-right mt-2"},r.a.createElement("small",null,"* only files less than 5 mb are allowed")))))},Le=a(196),Ue=function(e){var t=e.afterUpload,a=Object(i.h)().chatId,c=Object(n.useState)(!1),l=Object(T.a)(c,2),o=l[0],s=l[1],d=Object(n.useState)(!1),f=Object(T.a)(d,2),b=f[0],h=f[1],E=Object(n.useCallback)((function(){s((function(e){return!e}))}),[]),v=Object(n.useCallback)(function(){var e=Object(m.a)(u.a.mark((function e(n){var r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),e.prev=1,e.next=4,y.ref("/chat/".concat(a)).child("audio_".concat(Date.now(),".mp3")).put(n.blob,{cacheControl:"public, max-age=".concat(259200)});case 4:return r=e.sent,e.t0=r.metadata.contentType,e.t1=r.metadata.name,e.next=9,r.ref.getDownloadURL();case 9:e.t2=e.sent,c={contentType:e.t0,name:e.t1,url:e.t2},h(!1),t([c]),e.next=19;break;case 15:e.prev=15,e.t3=e.catch(1),h(!1),p.a.error(e.t3.message);case 19:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(t){return e.apply(this,arguments)}}(),[t,a]);return r.a.createElement(R.a.Button,{onClick:E,disabled:b,className:o?"animate-blink":""},r.a.createElement(O.a,{icon:"microphone"}),r.a.createElement(Le.ReactMic,{record:o,className:"d-none",onStop:v,mimeType:"audio/mp3"}))};function He(e,t){return{roomId:t,author:Object(q.a)({name:e.name,uid:e.uid,createdAt:e.createdAt},e.avatar?{avatar:e.avatar}:{}),createdAt:f.a.database.ServerValue.TIMESTAMP,likeCount:0}}var Me=function(){var e=Object(n.useState)(""),t=Object(T.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(!1),o=Object(T.a)(l,2),s=o[0],d=o[1],f=Object(i.h)().chatId,b=U().profile,h=Object(n.useCallback)((function(e){c(e)}),[]),E=function(){var e=Object(m.a)(u.a.mark((function e(){var t,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==a.trim()){e.next=2;break}return e.abrupt("return");case 2:return(t=He(b,f)).text=a,n={},r=w.ref("messages").push().key,n["/messages/".concat(r)]=t,n["/rooms/".concat(f,"/lastMessage")]=Object(q.a)(Object(q.a)({},t),{},{msgId:r}),d(!0),e.prev=9,e.next=12,w.ref().update(n);case 12:c(""),d(!1),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(9),d(!1),p.a.error(e.t0.message);case 20:case"end":return e.stop()}}),e,null,[[9,16]])})));return function(){return e.apply(this,arguments)}}(),v=Object(n.useCallback)(function(){var e=Object(m.a)(u.a.mark((function e(t){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!0),a={},t.forEach((function(e){var t=He(b,f);t.file=e;var n=w.ref("messages").push().key;a["/messages/".concat(n)]=t})),n=Object.keys(a).pop(),a["/rooms/".concat(f,"/lastMessage")]=Object(q.a)(Object(q.a)({},a[n]),{},{msgId:n}),e.prev=5,e.next=8,w.ref().update(a);case 8:d(!1),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(5),d(!1),p.a.error(e.t0.message);case 15:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}(),[f,b]);return r.a.createElement("div",null,r.a.createElement(R.a,null,r.a.createElement(De,{afterUpload:v}),r.a.createElement(Ue,{afterUpload:v}),r.a.createElement(V.a,{placeholder:"Write a new message here...",value:a,onChange:h,onKeyDown:function(e){13===e.keyCode&&(e.preventDefault(),E())}}),r.a.createElement(R.a.Button,{color:"blue",appearance:"primary",onClick:E,disabled:s},r.a.createElement(O.a,{icon:"send"}))))},Fe=a(197),Be=function(e){var t=e.profile,a=e.children,n=Object(N.a)(e,["profile","children"]),c=B(),l=c.isOpen,o=c.close,i=c.open,s=t.name,u=t.avatar,m=t.createdAt,d=t.name.split(" ")[0],f=new Date(m).toLocaleDateString();return r.a.createElement(r.a.Fragment,null,r.a.createElement(k.a,Object.assign({},n,{onClick:i}),d),r.a.createElement(K.a,{show:l,onHide:o},r.a.createElement(K.a.Header,null,r.a.createElement(K.a.Title,null,d," profile")),r.a.createElement(K.a.Body,{className:"text-center"},r.a.createElement(ee,{src:u,name:s,className:"width-200 height-200 img-fullsize font-huge"}),r.a.createElement("h4",{className:"mt-2"},s),r.a.createElement("p",null,"Member since ",f)),r.a.createElement(K.a.Footer,null,a,r.a.createElement(k.a,{block:!0,onClick:o},"Close"))))},Pe=a(191),Re=a(200),Ve=a(403),ze=function(e){if(!e)return"gray";switch(e.state){case"online":return"green";case"offline":return"red";default:return"gray"}},We=function(e){return e?"online"===e.state?"Online":"Last online ".concat(new Date(e.last_changed).toLocaleDateString()):"Unknown state"},qe=function(e){var t=function(e){var t=Object(n.useState)(null),a=Object(T.a)(t,2),r=a[0],c=a[1];return Object(n.useEffect)((function(){var t=w.ref("/status/".concat(e));return t.on("value",(function(e){if(e.exists()){var t=e.val();c(t)}})),function(){t.off()}}),[e]),r}(e.uid);return r.a.createElement(Pe.a,{placement:"top",trigger:"hover",speaker:r.a.createElement(Re.a,null,We(t))},r.a.createElement(Ve.a,{className:"cursor-pointer",style:{backgroundColor:ze(t)}}))},_e=a(199),Ge=function(e){var t=e.condition,a=e.children;return t?r.a.createElement(Ve.a,{content:t},a):a},Ke=function(e){var t=e.isVisible,a=e.iconName,n=e.tooltip,c=e.onClick,l=e.badgeContent,o=Object(N.a)(e,["isVisible","iconName","tooltip","onClick","badgeContent"]);return r.a.createElement("div",{className:"ml-2",style:{visibility:t?"visible":"hidden"}},r.a.createElement(Ge,{condition:l},r.a.createElement(Pe.a,{placement:"top",delay:0,delayHide:0,delayShow:0,trigger:"hover",speaker:r.a.createElement(Re.a,null,n)},r.a.createElement(_e.a,Object.assign({},o,{onClick:c,circle:!0,size:"xs",icon:r.a.createElement(O.a,{icon:a})})))))},Je=function(e){var t=e.src,a=e.fileName,n=B(),c=n.isOpen,l=n.open,o=n.close;return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{type:"image",src:t,alt:"file",onClick:l,className:"mw-100 mh-100 w-auto"}),r.a.createElement(K.a,{show:c,onHide:o},r.a.createElement(K.a.Header,null,r.a.createElement(K.a.Title,null,a)),r.a.createElement(K.a.Body,null,r.a.createElement("div",null,r.a.createElement("img",{src:t,height:"100%",width:"100%",alt:"file"}))),r.a.createElement(K.a.Footer,null,r.a.createElement("a",{href:t,target:"_blank",rel:"noopener noreferrer"},"View original"))))},Ye=Object(n.memo)((function(e){var t=e.message,a=e.handleAdmin,c=e.handleLike,l=e.handleDelete,o=t.author,i=t.createdAt,s=t.text,u=t.file,m=t.likes,d=t.likeCount,f=function(){var e=Object(n.useState)(!1),t=Object(T.a)(e,2),a=t[0],r=t[1],c=Object(n.useRef)(null),l=function(){return r(!0)},o=function(){return r(!1)};return Object(n.useEffect)((function(){var e=c.current;return e&&(e.addEventListener("mouseover",l),e.addEventListener("mouseout",o)),function(){e.removeEventListener("mouseover",l),e.removeEventListener("mouseout",o)}}),[c.current]),[c,a]}(),p=Object(T.a)(f,2),b=p[0],h=p[1],E=P("(max-width: 992px)"),v=Ne((function(e){return e.isAdmin})),g=Ne((function(e){return e.admins})).includes(o.uid),O=x.currentUser.uid===o.uid,j=v&&!O,w=E||h,y=m&&Object.keys(m).includes(x.currentUser.uid);return r.a.createElement("li",{className:"padded mb-1 cursor-pointer ".concat(h?"bg-black-02":""),ref:b},r.a.createElement("div",{className:"d-flex align-items-center font-bolder mb-1"},r.a.createElement(qe,{uid:o.uid}),r.a.createElement(ee,{src:o.avatar,name:o.name,className:"ml-1",size:"xs"}),r.a.createElement(Be,{profile:o,appearance:"link",className:"p-0 ml-1 text-black"},j&&r.a.createElement(k.a,{block:!0,onClick:function(){return a(o.uid)},color:"blue"},g?"Remove admin permission":"Give admin in this room")),r.a.createElement(he.a,{datetime:i,className:"font-normal text-black-45 ml-2"}),r.a.createElement(Ke,Object.assign({},y?{color:"red"}:{},{isVisible:w,iconName:"heart",tooltip:"Like this message",onClick:function(){return c(t.id)},badgeContent:d})),O&&r.a.createElement(Ke,{isVisible:w,iconName:"close",tooltip:"Delete this message",onClick:function(){return l(t.id,u)}})),r.a.createElement("div",null,s&&r.a.createElement("span",{className:"word-breal-all"},s),u&&function(e){return e.contentType.includes("image")?r.a.createElement("div",{className:"height-220"},r.a.createElement(Je,{src:e.url,fileName:e.name})):e.contentType.includes("audio")?r.a.createElement("audio",{controls:!0},r.a.createElement("source",{src:e.url,type:"audio/mp3"}),"Your browser does not support the audio element."):r.a.createElement("a",{href:e.url},"Download ",e.name)}(u)))})),Ze=w.ref("/messages");var Qe=function(){var e=Object(i.h)().chatId,t=Object(n.useState)(null),a=Object(T.a)(t,2),c=a[0],l=a[1],o=Object(n.useState)(15),s=Object(T.a)(o,2),d=s[0],f=s[1],b=Object(n.useRef)(),h=c&&0===c.length,E=c&&c.length>0,v=Object(n.useCallback)((function(t){var a=b.current;Ze.off(),Ze.orderByChild("roomId").equalTo(e).limitToLast(t||15).on("value",(function(e){var t=Q(e.val());l(t),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,a=100*e.scrollTop/(e.scrollHeight-e.clientHeight)||0;return a>t}(a)&&(a.scrollTop=a.scrollHeight)})),f((function(e){return e+15}))}),[e]),g=Object(n.useCallback)((function(){var e=b.current,t=e.scrollHeight;v(d),setTimeout((function(){var a=e.scrollHeight;e.scrollTop=a-t}),200)}),[v,d]);Object(n.useEffect)((function(){var e=b.current;return v(),setTimeout((function(){e.scrollTop=e.scrollHeight}),200),function(){Ze.off("value")}}),[v]);var O=Object(n.useCallback)(function(){var t=Object(m.a)(u.a.mark((function t(a){var n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=w.ref("/rooms/".concat(e,"/admins")),t.next=3,n.transaction((function(e){return e&&(e[a]?(e[a]=null,r="Admin permission removed"):(e[a]=!0,r="Admin permission granted")),e}));case 3:p.a.info(r,4e3);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]),j=Object(n.useCallback)(function(){var e=Object(m.a)(u.a.mark((function e(t){var a,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=x.currentUser.uid,n=w.ref("/messages/".concat(t)),e.next=4,n.transaction((function(e){return e&&(e.likes&&e.likes[a]?(e.likeCount-=1,e.likes[a]=null,r="Like removed"):(e.likeCount+=1,e.likes||(e.likes={}),e.likes[a]=!0,r="Like added")),e}));case 4:p.a.info(r,4e3);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),C=Object(n.useCallback)(function(){var t=Object(m.a)(u.a.mark((function t(a,n){var r,l,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(window.confirm("Delete this message?")){t.next=2;break}return t.abrupt("return");case 2:return r=c[c.length-1].id===a,(l={})["/messages/".concat(a)]=null,r&&c.length>1&&(l["/rooms/".concat(e,"/lastMessage")]=Object(q.a)(Object(q.a)({},c[c.length-2]),{},{msgId:c[c.length-2].id})),r&&1===c.length&&(l["/rooms/".concat(e,"/lastMessage")]=null),t.prev=7,t.next=10,w.ref().update(l);case 10:p.a.info("Message has been deleted"),t.next=16;break;case 13:return t.prev=13,t.t0=t.catch(7),t.abrupt("return",p.a.error(t.t0.message));case 16:if(!n){t.next=26;break}return t.prev=17,o=y.refFromURL(n.url),t.next=21,o.delete();case 21:t.next=26;break;case 23:t.prev=23,t.t1=t.catch(17),p.a.error(t.t1.message);case 26:case"end":return t.stop()}}),t,null,[[7,13],[17,23]])})));return function(e,a){return t.apply(this,arguments)}}(),[e,c]);return r.a.createElement("ul",{ref:b,className:"msg-list custom-scroll"},c&&c.length>=15&&r.a.createElement("li",{className:"text-center mt-2 mb-2"},r.a.createElement(k.a,{onClick:g,color:"green"},"Load more")),h&&r.a.createElement("li",null,"No messages yet"),E&&function(){var e,t=(e=function(e){return new Date(e.createdAt).toDateString()},c.reduce((function(t,a){var n=e(a);return t[n]||(t[n]=[]),t[n].push(a),t}),{})),a=[];return Object.keys(t).forEach((function(e){a.push(r.a.createElement("li",{key:e,className:"text-center mb-1 padded"},e));var n=t[e].map((function(e){return r.a.createElement(Ye,{key:e.id,message:e,handleAdmin:O,handleLike:j,handleDelete:C})}));a.push.apply(a,Object(Fe.a)(n))})),a}())},Xe=function(){var e=Object(i.h)().chatId,t=ke();if(!t)return r.a.createElement(S.a,{center:!0,vertical:!0,size:"md",content:"Loading",speed:"slow"});var a=t.find((function(t){return t.id===e}));if(!a)return r.a.createElement("h6",{className:"text-center mt-page"},"Chat ",e," not found");var n,c=a.name,l=a.description,o=(n=a.admins)?Object.keys(n):[],s=o.includes(x.currentUser.uid),u={name:c,description:l,admins:o,isAdmin:s};return r.a.createElement(Ce,{data:u},r.a.createElement("div",{className:"chat-top"},r.a.createElement(Ae,null)),r.a.createElement("div",{className:"chat-middle"},r.a.createElement(Qe,null)),r.a.createElement("div",{className:"chat-bottom"},r.a.createElement(Me,null)))},$e=function(){var e=P("(min-width: 992px)"),t=Object(i.i)().isExact,a=e||t;return r.a.createElement(ge,null,r.a.createElement(h.a,{fluid:!0,className:"h-100"},r.a.createElement(E.a,{className:"h-100"},a&&r.a.createElement(v.a,{xs:24,md:8,className:"h-100"},r.a.createElement(je,null)),r.a.createElement(i.d,null,r.a.createElement(i.b,{exact:!0,path:"/chat/:chatId"},r.a.createElement(v.a,{xs:24,md:16,className:"h-100"},r.a.createElement(Xe,null))),r.a.createElement(i.b,null,e&&r.a.createElement(v.a,{xs:24,md:16,className:"h-100"},r.a.createElement("h6",{className:"text-center mt-page"},"Please select chat")))))))},et=function(e){var t=e.children,a=Object(N.a)(e,["children"]),n=U(),c=n.profile,l=n.isLoading;return l&&!c?r.a.createElement(b.a,null,r.a.createElement(S.a,{center:!0,vertical:!0,size:"md",content:"Loading",speed:"slow"})):c&&!l?r.a.createElement(i.a,{to:"/"}):r.a.createElement(i.b,a,t)};var tt=function(){return r.a.createElement(L,null,r.a.createElement(i.d,null,r.a.createElement(et,{path:"/signin"},r.a.createElement(C,null)),r.a.createElement(H,{path:"/"},r.a.createElement($e,null))))};l.a.render(r.a.createElement(o.a,null,r.a.createElement(tt,null)),document.getElementById("root"))}},[[201,1,2]]]);
//# sourceMappingURL=main.3bbad57c.chunk.js.map